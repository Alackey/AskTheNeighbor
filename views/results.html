<div class="filters">
  <div class="filtersBox">
    <div class="filterChoices">
      <div class="container-fluid">
        <div class="row">
          <div class="col-md-3 col-sm-6 col-xs-6">
            <div class="btn-filter btn-filter-checked btn-filter-med btnAmenities">
              <span class="filterName">Amenities</span>
              <img src="images/checkmark.png" class="btn-image-check">
            </div>
          </div>
          <div class="col-md-3 col-sm-6 col-xs-6">
            <div class="btn-filter btn-filter-checked btn-filter-med btnTransit">
              <span class="filterName">Transit</span>
              <img src="images/checkmark.png" class="btn-image-check">
            </div>
          </div>
          <div class="col-md-3 col-sm-6 col-xs-6">
            <div class="btn-filter btn-filter-checked btn-filter-med btnBuy">
              <span class="filterName">Buy Property</span>
              <img src="images/checkmark.png" class="btn-image-check">
            </div>
          </div>
          <div class="col-md-3 col-sm-6 col-xs-6">
            <div class="btn-filter btn-filter-checked btn-filter-med btnRent">
              <span class="filterName">Rent Property</span>
              <img src="images/checkmark.png" class="btn-image-check">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <br>
  <div class="filtersExtra">
    <div class="filtersExtraBox">
      <div class="filtersExtraBoxChoices">
        <div class="row">
          <div class="col-md-6 col-sm-6">
            <div class="btn-filter btn-filter-unchecked btn-filter-med btnCheckToggle">
              <span class="lblCheck">Check/Uncheck</span>
            </div>
          </div>
          <div class="col-md-6 col-sm-6">
            <div class="btn-filter btn-filter-unchecked btn-filter-med btnAdvanced">
              <span class="lblAdSearch">Advanced Search</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Weather -->
<div class="weather">
  <h1 id="weatherTitle">WEATHER</h1>
  <div class="container-fluid">
    <!--Weekly Weather Row-->
    <div class="row">
      <div class="col-xs-12">
        <h3 class="text-center">Weekly</h3>
        <div class="weather">
          <div class="center-row">
            <div class="row">
              <div class="col-xs-2">Sun</div>
              <div class="col-xs-1">Mon</div>
              <div class="col-xs-2">Tue</div>
              <div class="col-xs-1">Wed</div>
              <div class="col-xs-2">Thu</div>
              <div class="col-xs-1">Fri</div>
              <div class="col-xs-2">Sat</div>
            </div>
          </div>
          <div class="center-row">
            <div id="weeklyImg" class="row"></div>
          </div>
          <div class="center-row">
            <div id="weeklyOutput" class="row"></div>
          </div>
        </div>
      </div>
    </div>
    <!--Seasonal Weather Row-->
    <div class="row">
      <div class="col-xs-12">
        <h3 class="text-center">Seasonal</h3>
        <div class="weather">
          <div class="center-row">
            <div class="row">
              <div class="col-xs-3">Spring</div>
              <div class="col-xs-3">Summer</div>
              <div class="col-xs-3">Autumn</div>
              <div class="col-xs-3">Winter</div>
            </div>
          </div>
          <div class="center-row">
            <div id="seasonalImg" class="row"></div>
          </div>
          <div class="center-row">
            <div id="seasonalOutput" class="row"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Map -->
<div class="map">
  <div class="container-fluid">
    <h1 id="mapTitle">MAP</h1>
    <div class="row">
      <div class="col-md-4"></div>
      <!--Legend for markers-->
      <div class="col-md-4 text-center">
        <div class="row">
          <h3 class="col-md-3">Legend:</h3>
          <div class="col-md-3">
            <img src="images/icons/transportation.png">
            <p>Transportation</p>
          </div>
          <div class="col-md-3">
            <img src="images/icons/amenity.png">
            <p>Amenities</p>
          </div>
          <div class="col-md-3">
            <img src="images/icons/property.png">
            <div>Properties</div>
          </div>
        </div>
      </div>
      <div class="col-md-4"></div>
    </div>

    <div id="map"></div>
    <div id="map-errors" class="text-center"></div>
  </div>
</div>

<div class="crimeList">
  <h1 id="crimeTitle">CRIME</h1>
  <table id="table_id" class="display">
    <thead>
      <tr>
        <th>Population</th>
        <th>Year</th>
        <th>Violent Crime</th>
        <th>Murder &amp; Nonnegligent Manslaughter</th>
        <th>Rape</th>
        <th>Robbery</th>
        <th>Aggrevated Assault</th>
        <th>Property Crime</th>
        <th>Burglary</th>
        <th>Larceny-Theft</th>
        <th>Motor Vehicle Theft</th>
        <th>Arson</th>
      </tr>
    </thead>
    <tbody>
    </tbody>
  </table>
</div>

<script>
  //ON/OFF CLICK TOGGLE FOR FILTERS
  $(".btnAmenities, .btnTransit, .btnBuy, .btnRent").click(function () {
    $(this).toggleClass("btn-filter-unchecked");
    $(this).find("img").toggle();
  });

  $(".btnCheckToggle").click(function () {
    if ($(this).hasClass("btn-filter-checked")) {
      $(".btnAmenities, .btnTransit, .btnBuy, .btnRent").toggleClass("btn-filter-checked");
      $(".btnAmenities, .btnTransit, .btnBuy, .btnRent").find("img").toggle();
    }

    if ($(this).hasClass("btn-filter-unchecked")) {
      $(".btnAmenities, .btnTransit, .btnBuy, .btnRent").toggleClass("btn-filter-unchecked");
      $(".btnAmenities, .btnTransit, .btnBuy, .btnRent").find("img").toggle();
    }
  });
</script>

<script>
  var map;
  var twoMarkers = {
    "data": {
      "results": [{
          "name": "Downtown Manhattan Heliport",
          "address": "6 East River Bikeway, New York",
          "lat": 40.7015101,
          "long": -74.0091494,
          "rating": 4.7,
          "type": "airport",
          "open": true
        },
        {
          "name": "Saker Aviation Services",
          "address": "6 East River Bikeway, New York",
          "lat": 40.701457,
          "long": -74.009225,
          "rating": 5,
          "type": "airport"
        }
      ],
      "status": "OK"
    }
  };

  var weatherReport = {
    "weekly": [{
        temp: 100,
        icon: "sunny"
      },
      {
        temp: 75,
        icon: "rainy"
      },
      {
        temp: 65,
        icon: "cloudy"
      },
      {
        temp: 63,
        icon: "rainy"
      },
      {
        temp: 55,
        icon: "foggy"
      },
      {
        temp: 79,
        icon: "sunny"
      },
      {
        temp: 86,
        icon: "sunny"
      }
    ],
    "seasonal": [{
        temp: 85,
        icon: "rainy"
      },
      {
        temp: 100,
        icon: "sunny"
      },
      {
        temp: 70,
        icon: "cloudy"
      },
      {
        temp: 30,
        icon: "snowy"
      }
    ]
  }

  setWeather();
  initMap();
  searchMap();

  // Display map
  function initMap() {
    var coordinates = {
      lat: 40,
      lng: -100
    };
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 4,
      center: coordinates
    });
  }

  // Zoom into curernt location
  function searchMap() {
    console.log("Search map: " + JSON.stringify(local));
    var lat = local.lat;
    var lng = local.long;

    map.setCenter(new google.maps.LatLng(lat, lng));
    map.setZoom(13);

    var marker = new google.maps.Marker({
      position: {
        lat: lat,
        lng: lng
      },
      map: map
      //icon: "icons/marker.png"
    });


    // call function to get information about all properites, amenities, and transportation in the area
    //getMarkers(lat, lng);
  }

  // Get the amenity services
  function getAmenities() {
    $.ajax({
        url: "/amenities?lat=" + local.lat + "&long=" + local.long + "&radius=" + local.range
      })
      .done(function (data) {
        setMarkers(data);
      })
      .fail(function (jq, text, err) {
        var mapErrors = $('#map-errors');

        if (mapErrors.children().length == 0) {
          mapErrors.append('<h3>Error</h3>');
        }
        mapErrors.append('<p>No amenities found. Increase radius.</p>');
      });
  }

  // Get the transportation services
  function getTransportation() {
    $.ajax({
        url: "/transportation?lat=" + local.lat + "&long=" + local.long + "&radius=" + local.range
      })
      .done(function (data) {
        setMarkers(data);
      })
      .fail(function (jq, text, err) {
        var mapErrors = $('#map-errors');

        if (mapErrors.children().length == 0) {
          mapErrors.append('<h3>Error</h3>');
        }
        mapErrors.append('<p>No transportation found. Increase radius.</p>');
      });
  }

  // Set the markers
  function setMarkers(data) {
    var type = data.data.type;

    data.data.results.forEach(function (marker) {
      var coordinates = new google.maps.LatLng(marker.lat, marker.long);
      var setUp = {
        position: coordinates,
        map: map,
        title: marker.name
      }

      // Set icon
      if (type == "transportation") {
        setUp.icon = "images/icons/transportation.png";
      } else if (type == "amenity") {
        setUp.icon = "images/icons/amenity.png";
      }
      var completeMarker = new google.maps.Marker(setUp);

      var infowindow = new google.maps.InfoWindow({
        content: JSON.stringify(marker)
      });

      // adding an on click listener to show info about the particular marker
      completeMarker.addListener("click", function () {
        infowindow.open(map, completeMarker);
      });
    });
  }

  // gets the crimes
  function getCrimes() {
    $.ajax({
        url: "/crime?state=" + local.state_short + "&city=" + local.city
      })
      .done(function (data) {
        var tbody = $('#table_id > tbody');

        data.data.results.forEach(function (crimes) {
          crimes.Crimes.forEach(function (crime) {
            var row =
              '<tr>' +
                '<td>' + crime.Population + '</td>' +
                '<td>' + crime.Year + '</td>' +
                '<td>' + crime.ViolentCrime + '</td>' +
                '<td>' + crime.Murder + '</td>' +
                '<td>' + crime.Rape + '</td>' +
                '<td>' + crime.Robbery + '</td>' +
                '<td>' + crime.AggravatedAssault + '</td>' +
                '<td>' + crime.PropertyCrime + '</td>' +
                '<td>' + crime.Burglary + '</td>' +
                '<td>' + crime.Larceny + '</td>' +
                '<td>' + crime.VehicleTheft + '</td>' +
                '<td>' + crime.Arson + '</td>' +
              '</tr>';

            tbody.append(row);
          });
        });
        // Init crime table
        $('#table_id').DataTable();
      })
      .fail(function (jq, text, err) {
        var crimeList = $('.crimeList');

        if (crimeList.children().length == 0) {
          crimeList.append('<h3>Error</h3>');
        }
        crimeList.append('<h3>Error</h3><p>Crime for your city not available.</p>');
      });
  }

  // Set the temperatures for the week and the seasons along with their appropriate images
  function setWeather( /*weeklyTemp, seasonTemp*/ ) {

    var weeklyOutput = document.getElementById("weeklyOutput");
    var weeklyImg = document.getElementById("weeklyImg");
    var seasonalOutput = document.getElementById("seasonalOutput");
    var seasonalImg = document.getElementById("seasonalImg");

    // Loop through the seven days of the week and set the temperature and icon
    for (i = 0; i < 7; i++) {
      // create a dynamic div for each day of the week for the temperature
      var weatherDiv = document.createElement("div");
      if (i % 2 == 0) {
        weatherDiv.setAttribute("class", "col-xs-2");
      } else {
        weatherDiv.setAttribute("class", "col-xs-1");
      }
      weatherDiv.innerHTML = weatherReport.weekly[i].temp + "&#8457;";
      weeklyOutput.appendChild(weatherDiv);

      // create a dynamic div for each day of the week for the icon
      var imgDiv = document.createElement("div");
      if (i % 2 == 0) {
        imgDiv.setAttribute("class", "col-xs-2");
      } else {
        imgDiv.setAttribute("class", "col-xs-1");
      }

      // create a dynamic img for each day of the week for the icon
      var imgEle = document.createElement("img");

      imgEle.setAttribute("height", 15);
      imgEle.setAttribute("width", 15);

      switch (weatherReport.weekly[i].icon) {
        case "sunny":
          imgEle.setAttribute("src", "images/icons/sunny.png");
          break;
        case "cloudy":
          imgEle.setAttribute("src", "images/icons/cloudy.png");
          break;
        case "foggy":
          imgEle.setAttribute("src", "images/icons/foggy.png");
          break;
        case "rainy":
          imgEle.setAttribute("src", "images/icons/rainy.png");
          break;
        case "snowy":
          imgEle.setAttribute("src", "images/icons/snowy.png");
          break;
        default:
          imgEle.setAttribute("src", "images/icons/sunny.png");
      }

      imgDiv.appendChild(imgEle);
      weeklyImg.appendChild(imgDiv);
    }

    for (i = 0; i < 4; i++) {
      // create a dynamic div for each season of the year for the temperature
      var weatherDiv = document.createElement("div");
      weatherDiv.setAttribute("class", "col-xs-3");
      weatherDiv.innerHTML = weatherReport.seasonal[i].temp + "&#8457;";
      seasonalOutput.appendChild(weatherDiv);

      // create a dynamic div for each season of the year for the icon
      var imgDiv = document.createElement("div");
      imgDiv.setAttribute("class", "col-xs-3");

      // create a dynamic img for each season of the year for the icon
      var imgEle = document.createElement("img");

      imgEle.setAttribute("height", 15);
      imgEle.setAttribute("width", 15);

      switch (weatherReport.seasonal[i].icon) {
        case "sunny":
          imgEle.setAttribute("src", "images/icons/sunny.png");
          break;
        case "cloudy":
          imgEle.setAttribute("src", "images/icons/cloudy.png");
          break;
        case "foggy":
          imgEle.setAttribute("src", "images/icons/foggy.png");
          break;
        case "rainy":
          imgEle.setAttribute("src", "images/icons/rainy.png");
          break;
        case "snowy":
          imgEle.setAttribute("src", "images/icons/snowy.png");
          break;
        default:
          imgEle.setAttribute("src", "images/icons/sunny.png");
      }

      imgDiv.appendChild(imgEle);
      seasonalImg.appendChild(imgDiv);
    }
  }
</script>